## Various code from Andrzej - needs documentation